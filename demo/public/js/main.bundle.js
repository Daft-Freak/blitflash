(()=>{"use strict";var e={349:(e,t,i)=>{t.E=void 0;const n=i(732);Object.defineProperty(t,"E",{enumerable:!0,get:function(){return n.BlitFlasher}})},426:function(e,t,i){var n=this&&this.__awaiter||function(e,t,i,n){return new(i||(i=Promise))((function(r,o){function d(e){try{a(n.next(e))}catch(e){o(e)}}function s(e){try{a(n.throw(e))}catch(e){o(e)}}function a(e){var t;e.done?r(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(d,s)}a((n=n.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0}),t.BlitConnection=void 0;const r=i(164),o=i(479);t.BlitConnection=class{constructor(e,t){this.reader=e,this.writer=t,this.encoder=new TextEncoder,this.decoder=new TextDecoder,this.readBuffer=new o.ReadBuffer,this.readLoop()}readLoop(){return n(this,void 0,void 0,(function*(){for(;;){const{value:e,done:t}=yield this.reader.read();if(e&&this.readBuffer.append(e),t){this.reader.releaseLock(),this.readBuffer.failPendingPromises(new Error("ReadableStream is done."));break}}}))}write(e){return n(this,void 0,void 0,(function*(){const t=this.encoder.encode(e);yield this.writer.write(t)}))}close(){return n(this,void 0,void 0,(function*(){yield this.writer.close(),yield this.reader.cancel()}))}reset(){return n(this,void 0,void 0,(function*(){yield this.write("32BL_RST\0"),yield this.writer.ready}))}status(){return n(this,void 0,void 0,(function*(){yield this.write("32BLINFO\0");const e=yield this.readBuffer.read(8);return this.decoder.decode(e)}))}list(){return n(this,void 0,void 0,(function*(){const e=[];yield this.write("32BL__LS\0");let t=yield this.readBuffer.readUint32(!0);for(;4294967295!==t;){let i=yield this.readBuffer.readUint32(!0);const n=this.decoder.decode(yield this.readBuffer.read(8));if("BLITMETA"!==n)throw new Error(`Incorret meta header. Received ${n}`);const o=yield this.readBuffer.readUint16(!0);let d;o>0&&(i=i+o+10,d=yield r.BlitMetaStandalone.parse(this.readBuffer,o)),e.push({offset:t,size:i,meta:d}),t=yield this.readBuffer.readUint32(!0)}return e}))}}},732:function(e,t,i){var n=this&&this.__awaiter||function(e,t,i,n){return new(i||(i=Promise))((function(r,o){function d(e){try{a(n.next(e))}catch(e){o(e)}}function s(e){try{a(n.throw(e))}catch(e){o(e)}}function a(e){var t;e.done?r(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(d,s)}a((n=n.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0}),t.BlitFlasher=void 0;const r=i(426),o=i(437);t.BlitFlasher=class{constructor(e){this.port=e}open(){return n(this,void 0,void 0,(function*(){yield this.port.open({baudRate:115200,dataBits:8,stopBits:1}),this.connection=new r.BlitConnection(this.port.readable.getReader(),this.port.writable.getWriter())}))}close(){var e;return n(this,void 0,void 0,(function*(){null===(e=this.connection)||void 0===e||e.close()}))}status(){return n(this,void 0,void 0,(function*(){return this.connection.status()}))}list(){return n(this,void 0,void 0,(function*(){return this.connection.list()}))}reset(){return n(this,void 0,void 0,(function*(){this.connection&&(yield this.connection.reset(),yield this.connection.close(),yield this.port.close()),yield o.sleep(1e3),yield this.open()}))}}},164:function(e,t){var i=this&&this.__awaiter||function(e,t,i,n){return new(i||(i=Promise))((function(r,o){function d(e){try{a(n.next(e))}catch(e){o(e)}}function s(e){try{a(n.throw(e))}catch(e){o(e)}}function a(e){var t;e.done?r(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(d,s)}a((n=n.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0}),t.BlitMetaStandalone=t.BlitImage=void 0;class n{constructor(e,t,i,n,r,o,d){this.type=e,this.dataLength=t,this.width=i,this.height=n,this.format=r,this.pallete=o,this.pixels=d}static parse(e){return i(this,void 0,void 0,(function*(){const t=yield e.readString(6);if("SPRITE"!==t)throw new Error(`Invalid header for BlitImage: ${t}`);const i=yield e.readString(2),r=yield e.readUint32(!0),o=yield e.readUint16(!0),d=yield e.readUint16(!0),s=yield e.readUint8(),a=yield e.readUint8(),c=yield e.read(4*a),u=yield e.read(r-18-4*a);return new n(i,r,o,d,s,c,u)}))}}t.BlitImage=n;class r{constructor(e,t,i,n,r,o,d,s,a,c,u,l){this.checksum=e,this.date=t,this.title=i,this.description=n,this.version=r,this.author=o,this.blittype=d,this.category=s,this.url=a,this.filetypes=c,this.icon=u,this.splash=l}static parse(e,t){return i(this,void 0,void 0,(function*(){const i=yield e.readUint32(!0),o=yield e.readString(16),d=yield e.readString(25),s=yield e.readString(129),a=yield e.readString(17),c=yield e.readString(17),u=yield e.readString(8);if("BLITTYPE"!==u)return yield e.read(t-216),new r(i,o,d,s,a,c,u);const l=yield e.readString(17),h=yield e.readString(129),f=yield e.readUint8(),v=[];for(let t=0;t<f;t++)v.push(yield e.readString(5));const y=yield n.parse(e),p=yield n.parse(e);return new r(i,o,d,s,a,c,u,l,h,v,y,p)}))}}t.BlitMetaStandalone=r},479:function(e,t){var i=this&&this.__awaiter||function(e,t,i,n){return new(i||(i=Promise))((function(r,o){function d(e){try{a(n.next(e))}catch(e){o(e)}}function s(e){try{a(n.throw(e))}catch(e){o(e)}}function a(e){var t;e.done?r(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(d,s)}a((n=n.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0}),t.ReadBuffer=void 0;class n{constructor(e,t,i){this.dataLength=e,this.resolve=t,this.reject=i}}t.ReadBuffer=class{constructor(e=1024){this.pendingPromises=[],this._size=0,this.decoder=new TextDecoder,this.buffer=new Uint8Array(new ArrayBuffer(e))}read(e){return i(this,void 0,void 0,(function*(){return 0===this.pendingPromises.length&&this.size()>=e?yield this.internalRead(e):new Promise(((t,i)=>{this.pendingPromises.push(new n(e,t,i))}))}))}readUint8(){return i(this,void 0,void 0,(function*(){const e=yield this.read(1);return new DataView(e.buffer).getUint8(0)}))}readUint16(e){return i(this,void 0,void 0,(function*(){const t=yield this.read(2);return new DataView(t.buffer).getUint16(0,e)}))}readUint32(e){return i(this,void 0,void 0,(function*(){const t=yield this.read(4);return new DataView(t.buffer).getUint32(0,e)}))}readString(e){return i(this,void 0,void 0,(function*(){const t=yield this.read(e);let i=t.findIndex((e=>0===e));return-1===i&&(i=e-1),this.decoder.decode(t.slice(0,i+1))}))}append(e){this.size()+e.byteLength>this.buffer.byteLength&&this.extendBuffer(),this.buffer.set(e,this.size()),this._size+=e.byteLength,this.tryResolvePendingPromises()}failPendingPromises(e){for(;this.pendingPromises.length>0;)this.pendingPromises.shift().reject(e)}size(){return this._size}capacity(){return this.buffer.byteLength}internalRead(e){return i(this,void 0,void 0,(function*(){if(this.size()<e)throw new Error(`Internal buffer has ${this.size} bytes, but tried to read ${e}.`);this._size-=e;const t=new Uint8Array(this.buffer.subarray(0,e));return this.buffer.copyWithin(0,e,e+this.size()),t}))}tryResolvePendingPromises(){return i(this,void 0,void 0,(function*(){for(;this.pendingPromises.length>0&&this.pendingPromises[0].dataLength<=this.size();){const e=this.pendingPromises.shift(),t=yield this.internalRead(e.dataLength);e.resolve(t)}}))}extendBuffer(){const e=new Uint8Array(new ArrayBuffer(2*this.buffer.byteLength));e.set(this.buffer),this.buffer=e}}},437:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.sleep=void 0,t.sleep=function(e){return new Promise((t=>setTimeout(t,e)))}}},t={};function i(n){var r=t[n];if(void 0!==r)return r.exports;var o=t[n]={exports:{}};return e[n].call(o.exports,o,o.exports,i),o.exports}(()=>{var e=i(349),t=function(e,t,i,n){return new(i||(i=Promise))((function(r,o){function d(e){try{a(n.next(e))}catch(e){o(e)}}function s(e){try{a(n.throw(e))}catch(e){o(e)}}function a(e){var t;e.done?r(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(d,s)}a((n=n.apply(e,t||[])).next())}))};const n=document.querySelector("#connect"),r=document.querySelector("#disconnect"),o=document.querySelector("#status"),d=document.querySelector("#reset"),s=document.querySelector("#list"),a=document.querySelector("#status_text"),c=document.querySelector("#list-content");let u;n.addEventListener("click",(()=>t(void 0,void 0,void 0,(function*(){const t=yield navigator.serial.requestPort();u=new e.E(t),yield u.open(),n.disabled=!0,r.disabled=!1,o.disabled=!1,d.disabled=!1,s.disabled=!1;const i=yield u.status();a.innerText=i})))),r.addEventListener("click",(()=>t(void 0,void 0,void 0,(function*(){yield u.close(),n.disabled=!1,r.disabled=!0,o.disabled=!0,d.disabled=!0,s.disabled=!0})))),d.addEventListener("click",(()=>t(void 0,void 0,void 0,(function*(){yield u.reset();const e=yield u.status();a.innerText=e})))),o.addEventListener("click",(()=>t(void 0,void 0,void 0,(function*(){const e=yield u.status();a.innerText=e})))),s.addEventListener("click",(()=>t(void 0,void 0,void 0,(function*(){(yield u.list()).forEach((e=>{var t,i,n,r,o;const d=document.createElement("tr");let s=document.createElement("td");s.innerText=(null===(t=e.meta)||void 0===t?void 0:t.title)||"",d.appendChild(s),s=document.createElement("td"),s.innerText=(null===(i=e.meta)||void 0===i?void 0:i.description)||"",d.appendChild(s),s=document.createElement("td"),s.innerText=(null===(n=e.meta)||void 0===n?void 0:n.author)||"",d.appendChild(s),s=document.createElement("td"),s.innerText=(null===(r=e.meta)||void 0===r?void 0:r.date)||"",d.appendChild(s),s=document.createElement("td"),s.innerText=(null===(o=e.meta)||void 0===o?void 0:o.version)||"",d.appendChild(s),c.appendChild(d)}))}))))})()})();